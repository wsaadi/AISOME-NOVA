# Agent Descriptor Language (ADL) v1.0.0
# AI Chat Agent - Conversational AI with governance

metadata:
  adl_version: "1.0.0"
  schema_url: "https://agent-pf.io/schemas/adl/v1"
  version: "1.0.0"
  tags:
    - chat
    - conversation
    - governance
    - moderation
  changelog:
    - "1.0.0: Initial ADL conversion"

identity:
  name: "AI Chat Agent"
  slug: "ai-chat-agent"
  description: "Agent de chat IA gouverné avec modération de contenu et classification"
  long_description: |
    Agent conversationnel intelligent avec gouvernance intégrée.

    ## Fonctionnalités
    - Chat textuel avec modération automatique
    - Analyse de documents (PDF, Word, Excel, etc.)
    - Analyse d'images avec vision IA
    - Classification automatique des requêtes
    - Support multi-LLM (Mistral, OpenAI)

    ## Gouvernance
    - Modération stricte des prompts
    - Classification des domaines métier
    - Filtrage du contenu inapproprié
  icon: "fa fa-comments"
  category: "conversation"
  status: "active"

business_logic:
  system_prompt: |
    Tu es un assistant IA professionnel et bienveillant.

    Règles:
    - Réponds toujours de manière professionnelle et respectueuse
    - Fournis des réponses claires, structurées et précises
    - Si tu ne connais pas la réponse, dis-le honnêtement
    - N'invente jamais d'informations
    - Respecte la confidentialité des données

    Format de réponse:
    - Utilise le markdown pour structurer tes réponses
    - Ajoute des listes à puces pour les énumérations
    - Mets en gras les points importants

  user_prompt_template: "{{user_message}}"

  personality_traits:
    - name: "professional"
      intensity: 1.5
    - name: "helpful"
      intensity: 1.3
    - name: "concise"
      intensity: 1.2

  tone: "professional"
  language: "auto"

  llm_provider: "mistral"
  llm_model: "mistral-small-latest"
  temperature: 0.7
  max_tokens: 4096

  context_window_messages: 10
  include_system_context: true
  streaming_enabled: true

  moderation:
    enabled: true
    provider: "prompt-moderation"
    block_on_fail: true
    risk_threshold: "medium"

  classification:
    enabled: true
    provider: "content-classification"
    min_professional_score: 0.3

  task_prompts:
    document_analysis: |
      Analyse le document suivant et fournis:
      1. Un résumé exécutif
      2. Les points clés
      3. Les actions recommandées

      Document: {{document_content}}

    image_analysis: |
      Analyse cette image et décris:
      1. Le contenu visuel
      2. Les éléments importants
      3. Le contexte apparent

  instructions:
    - "Toujours vérifier le contexte avant de répondre"
    - "Citer les sources quand applicable"
    - "Proposer des clarifications si la question est ambiguë"

  constraints:
    - "Ne jamais révéler d'informations personnelles"
    - "Ne pas fournir de conseils médicaux ou juridiques"
    - "Refuser les demandes inappropriées"

tools:
  tools:
    - tool_id: "prompt-moderation"
      name: "Modération de contenu"
      enabled: true
      description: "Vérifie que les messages respectent les règles de modération"
      parameters:
        - name: "content"
          source: "input"
          input_component: "chat_input"
      output_variable: "moderation_result"
      on_error: "stop"

    - tool_id: "content-classification"
      name: "Classification"
      enabled: true
      description: "Classifie le type de requête et le domaine métier"
      parameters:
        - name: "content"
          source: "input"
          input_component: "chat_input"
      output_variable: "classification_result"
      on_error: "continue"

    - tool_id: "document-extractor"
      name: "Extraction de documents"
      enabled: true
      description: "Extrait le texte des documents uploadés"
      parameters:
        - name: "file"
          source: "input"
          input_component: "file_upload"
      output_variable: "extracted_text"
      on_error: "continue"

  default_error_handling: "continue"
  parallel_execution: false

ui:
  show_header: true
  header_title: "AI Chat"
  header_subtitle: "Assistant IA professionnel avec gouvernance"
  header_icon: "fa fa-comments"

  sections:
    - name: "chat_section"
      layout_type: "column"
      components:
        - type: "chat_interface"
          name: "main_chat"
          label: "Conversation"
          auto_bind_output: true
          style:
            height: "calc(100vh - 200px)"

  show_sidebar: false
  show_footer: false
  show_actions: false

  theme: "auto"
  primary_color: "#3B82F6"

connectors:
  default_connector: "mistral-default"
  connectors:
    - id: "mistral-default"
      provider: "mistral"
      name: "Mistral AI"
      model: "mistral-small-latest"
      default_temperature: 0.7
      default_max_tokens: 4096
      retry_on_error: true
      max_retries: 3
      priority: 0

    - id: "mistral-large"
      provider: "mistral"
      name: "Mistral Large"
      description: "Pour l'analyse de documents complexes"
      model: "mistral-large-latest"
      default_temperature: 0.3
      default_max_tokens: 8192
      priority: 1

    - id: "pixtral-vision"
      provider: "mistral"
      name: "Pixtral Vision"
      description: "Pour l'analyse d'images"
      model: "pixtral-12b-2409"
      default_temperature: 0.5
      default_max_tokens: 4096
      priority: 2

  enable_fallback: true
  fallback_order:
    - "mistral-default"
    - "mistral-large"

workflows:
  workflows:
    - name: "Main Chat Flow"
      description: "Flux principal de conversation"
      trigger: "user_message"
      enabled: true
      steps:
        - id: "moderate"
          name: "Modérer le message"
          type: "tool_call"
          tool_config_id: "prompt-moderation"
          output_variable: "moderation"
          on_error: "stop"
          next_step: "check_moderation"

        - id: "check_moderation"
          name: "Vérifier la modération"
          type: "condition"
          condition:
            variable: "moderation.approved"
            operator: "eq"
            value: true
          on_true: "classify"
          on_false: "reject"

        - id: "classify"
          name: "Classifier la requête"
          type: "tool_call"
          tool_config_id: "content-classification"
          output_variable: "classification"
          on_error: "continue"
          next_step: "respond"

        - id: "respond"
          name: "Générer la réponse"
          type: "llm_call"
          output_variable: "response"

        - id: "reject"
          name: "Rejeter le message"
          type: "set_variable"
          variable_name: "response"
          variable_value: "Désolé, votre message ne respecte pas nos règles de modération."

      entry_step: "moderate"
      initial_variables:
        moderation: null
        classification: null
        response: null

  default_workflow: "main-chat"

security:
  requires_auth: false
  rate_limit_enabled: true
  requests_per_minute: 30
  requests_per_hour: 500
  sanitize_inputs: true
  max_input_length: 10000
  audit_logging: true

deployment:
  auto_route: true
  environment: "production"
  min_instances: 1
  max_instances: 5
  health_check_enabled: true
