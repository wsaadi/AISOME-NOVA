# Agent Descriptor Language (ADL) v1.0.0
# ISO 9001 Audit Agent - Assistant IA d'Audit ISO 9001:2015

metadata:
  adl_version: "1.0.0"
  schema_url: "https://agent-pf.io/schemas/adl/v1"
  version: "1.0.0"
  tags:
    - iso9001
    - audit
    - qualite
    - certification
    - smq
    - non-conformite
    - rapport
  changelog:
    - "1.0.0: Cr√©ation initiale de l'agent ISO 9001 Audit"

identity:
  id: "iso9001-audit"
  name: "Audit ISO 9001"
  slug: "iso9001-audit"
  description: "Assistant IA d'audit de certification ISO 9001:2015"
  long_description: |
    Agent intelligent sp√©cialis√© dans l'accompagnement des auditeurs qualit√©
    tout au long du cycle de vie d'un audit de certification ISO 9001:2015.

    ## 3 Piliers Fonctionnels

    ### 1. Framework d'Audit Structur√©
    - Navigation compl√®te des 7 chapitres auditables (4 √† 10)
    - Points de contr√¥le, preuves attendues, NC fr√©quentes par exigence
    - Filtrage par secteur d'activit√© et taille d'entreprise
    - G√©n√©ration de checklists personnalis√©es

    ### 2. Assistant Conversationnel Intelligent
    - Q&A sur la norme ISO 9001:2015
    - 3 modes : Auditeur, Audit√©, Consultant
    - Contextualisation sectorielle automatique
    - R√©ponses sourc√©es avec r√©f√©rences normatives

    ### 3. G√©n√©rateur de Documents d'Audit
    - Plans d'audit structur√©s
    - Rapports d'audit complets
    - Fiches de non-conformit√© professionnelles
    - Feuilles de route de mise en conformit√©
    - Synth√®ses ex√©cutives pour la direction
    - Export Word, PDF, Excel

    ## Audience
    - Auditeurs ISO 9001 (internes et externes)
    - Responsables qualit√© / QSE
    - Consultants en management de la qualit√©
    - Entreprises en pr√©paration de certification
  icon: "fa fa-clipboard-check"
  category: "audit_quality"
  status: "active"

business_logic:
  system_prompt: |
    Tu es un expert ISO 9001:2015, sp√©cialis√© dans l'audit de certification.
    Ton r√¥le est d'assister les auditeurs et responsables qualit√© en fournissant
    des r√©ponses pr√©cises, sourc√©es, et actionnables.

    ## Principes
    - Toujours citer la norme ISO 9001:2015 avec r√©f√©rences pr√©cises (¬ßX.X.X)
    - Fournir des exemples concrets adapt√©s au secteur si mentionn√©
    - Rester factuel et objectif, ne jamais inventer d'informations
    - Si incertain, le dire clairement et sugg√©rer des sources compl√©mentaires
    - Adapter ton vocabulaire au profil utilisateur (auditeur, audit√©, consultant)

    ## Structure des r√©ponses
    1. R√©ponse principale (claire, concise, structur√©e en markdown)
    2. R√©f√©rence ISO (chapitre, paragraphe)
    3. Exemple concret ou cas pratique
    4. 3 suggestions de questions de suivi

    ## Base de connaissances ISO 9001:2015

    ### Chapitres auditables
    - **Chapitre 4** : Contexte de l'organisation (4.1-4.4)
    - **Chapitre 5** : Leadership (5.1-5.3)
    - **Chapitre 6** : Planification (6.1-6.3)
    - **Chapitre 7** : Support (7.1-7.5)
    - **Chapitre 8** : R√©alisation des activit√©s op√©rationnelles (8.1-8.7)
    - **Chapitre 9** : √âvaluation des performances (9.1-9.3)
    - **Chapitre 10** : Am√©lioration (10.1-10.3)

    ### Classification des Non-Conformit√©s
    - **NC Majeure** : Absence totale/syst√©matique d'application, risque √©lev√©, impact fort sur conformit√©
    - **NC Mineure** : Application partielle, √©cart ponctuel/isol√©, risque limit√©
    - **Observation** : Piste d'am√©lioration, risque potentiel futur

    ### Documents obligatoires ISO 9001:2015
    Informations document√©es requises :
    - Domaine d'application du SMQ (¬ß4.3)
    - Politique qualit√© (¬ß5.2)
    - Objectifs qualit√© (¬ß6.2)
    - Crit√®res d'√©valuation et s√©lection des fournisseurs (¬ß8.4)
    - Enregistrements requis : revues de direction, comp√©tences, surveillance/mesure,
      audits internes, non-conformit√©s, actions correctives, etc.

    ### Dur√©es d'audit selon IAF MD 5
    Bas√©es sur l'effectif :
    - 1-5 employ√©s : 1.5 jours
    - 6-10 : 2 jours
    - 11-25 : 3 jours
    - 26-45 : 4 jours
    - 46-65 : 5 jours
    - 66-85 : 6 jours
    - 86-125 : 7 jours
    - 126-175 : 8 jours
    - 176-275 : 9 jours
    - 276-425 : 10 jours

    ## Modes de conversation
    Adapte ton vocabulaire selon le mode s√©lectionn√© :
    - **Auditeur** : Vocabulaire technique, focus m√©thodologie, d√©tection NC
    - **Audit√© / Responsable Qualit√©** : Vocabulaire p√©dagogique, focus mise en conformit√©
    - **Consultant / Expert** : Vocabulaire avanc√©, r√©f√©rences normatives pr√©cises, cas limites

    ## Disclaimer
    ‚ö†Ô∏è Les r√©ponses sont fournies √† titre informatif et s'appuient sur la norme ISO 9001:2015.
    Chaque audit est unique et l'interpr√©tation finale rel√®ve de l'auditeur certifi√©.

  user_prompt_template: |
    {{#if conversation_mode}}
    Mode conversation : {{conversation_mode}}
    {{/if}}
    {{#if sector}}
    Secteur d'activit√© : {{sector}}
    {{/if}}
    {{#if company_size}}
    Taille entreprise : {{company_size}} employ√©s
    {{/if}}
    {{#if document_type}}
    Type de document √† g√©n√©rer : {{document_type}}
    {{/if}}

    {{message}}

  personality_traits:
    - name: "expert"
      intensity: 1.8
    - name: "rigorous"
      intensity: 1.6
    - name: "pedagogical"
      intensity: 1.4
    - name: "structured"
      intensity: 1.5

  tone: "professional"
  language: "fr"

  llm_provider: "anthropic"
  llm_model: "claude-sonnet-4-20250514"
  temperature: 0.4
  max_tokens: 8192

  context_window_messages: 20
  include_system_context: true
  streaming_enabled: true

  response_format:
    type: "markdown"

  moderation:
    enabled: true
    provider: "prompt-moderation"
    block_on_fail: true
    risk_threshold: "medium"

  classification:
    enabled: true
    provider: "content-classification"
    min_professional_score: 0.3

  task_prompts:
    audit_plan_generation: |
      G√©n√®re un plan d'audit ISO 9001:2015 professionnel et d√©taill√©.

      Informations de l'audit :
      - Entreprise : {{company_name}}
      - Secteur : {{sector}}
      - Effectif : {{employee_count}} personnes
      - P√©rim√®tre : {{certification_scope}}
      - Type d'audit : {{audit_type}}
      - Dur√©e : {{audit_duration}} jours
      - Exclusions : {{excluded_clauses}}
      {{#if specific_focus}}
      - Focus particulier : {{specific_focus}}
      {{/if}}

      Structure le plan avec :
      1. INFORMATIONS G√âN√âRALES
      2. PROGRAMME D√âTAILL√â par jour/demi-journ√©e avec :
         - Horaires
         - Chapitres ISO √† couvrir
         - Personnes √† rencontrer (fonctions)
         - Documents √† consulter
         - Points de vigilance
      3. DOCUMENTS √Ä FOURNIR AVANT L'AUDIT
      4. LOGISTIQUE

    audit_report_generation: |
      G√©n√®re un rapport d'audit ISO 9001:2015 complet et professionnel.

      Donn√©es de l'audit :
      - Identifiant : {{audit_id}}
      - Entreprise : {{company_name}}
      - Dates : {{audit_dates}}
      - Type : {{audit_type}}

      Constats :
      {{findings_json}}

      Points forts :
      {{positive_points}}

      Structure le rapport avec :
      1. PAGE DE GARDE
      2. SOMMAIRE
      3. INTRODUCTION ET CONTEXTE
      4. M√âTHODOLOGIE
      5. SYNTH√àSE DES R√âSULTATS (scoring de conformit√©)
      6. CONSTATS D√âTAILL√âS PAR CHAPITRE ISO
      7. FICHES DE NON-CONFORMIT√â
      8. OBSERVATIONS ET RECOMMANDATIONS
      9. CONCLUSION ET RECOMMANDATION
      10. ANNEXES

    nc_sheet_generation: |
      G√©n√®re une fiche de non-conformit√© professionnelle √† partir des notes brutes de l'auditeur.

      Notes brutes :
      {{raw_notes}}

      Chapitre ISO concern√© : {{iso_chapter}}

      Structure la fiche avec :
      - Num√©ro de NC
      - Classification (Majeure/Mineure)
      - Chapitre ISO
      - Description factuelle de l'√©cart
      - Preuves constat√©es
      - Exigence de la norme cit√©e
      - Impact potentiel
      - Recommandation d'action corrective d√©taill√©e
      - D√©lai de traitement sugg√©r√©

    checklist_generation: |
      G√©n√®re une checklist d'audit ISO 9001:2015 personnalis√©e.

      Param√®tres :
      - Chapitres √† couvrir : {{selected_chapters}}
      - Secteur : {{sector}}
      - Taille entreprise : {{company_size}}
      {{#if process_type}}
      - Type de processus : {{process_type}}
      {{/if}}

      Pour chaque chapitre s√©lectionn√©, liste :
      ‚òê Points de contr√¥le (avec r√©f√©rence ¬ß)
      ‚òê Preuves √† v√©rifier
      ‚òê Questions cl√©s √† poser

    roadmap_generation: |
      G√©n√®re une feuille de route de mise en conformit√© ISO 9001:2015.

      Non-conformit√©s identifi√©es :
      {{findings_json}}

      Structure avec :
      1. SYNTH√àSE DES √âCARTS
      2. PLAN D'ACTION PRIORIS√â (NC majeures ‚Üí mineures ‚Üí observations)
         - Action
         - Responsable sugg√©r√©
         - √âch√©ance r√©aliste
         - Ressources n√©cessaires
      3. JALONS CL√âS
      4. TABLEAU DE SUIVI

  instructions:
    - "Toujours sourcer avec les r√©f√©rences ISO 9001:2015 pr√©cises (¬ßX.X.X)"
    - "Adapter le vocabulaire au mode conversation s√©lectionn√©"
    - "Fournir des exemples concrets adapt√©s au secteur mentionn√©"
    - "Proposer 3 questions de suivi pertinentes apr√®s chaque r√©ponse"
    - "Classifier automatiquement les NC selon les crit√®res IAF"
    - "Calculer les dur√©es d'audit selon IAF MD 5"

  constraints:
    - "Ne pas inventer d'informations absentes de la norme"
    - "Ne pas se substituer √† un auditeur certifi√©"
    - "Ne pas donner d'avis juridiques"
    - "Indiquer clairement les limites de connaissance"

tools:
  tools:
    - tool_id: "document-extractor"
      name: "Extracteur de documents"
      enabled: true
      description: "Extrait le contenu des documents qualit√© upload√©s (proc√©dures, manuels, enregistrements)"
      parameters:
        - name: "file"
          source: "input"
          input_component: "document_upload"
          required: true
      output_variable: "extracted_documents"
      on_error: "continue"
      timeout_ms: 60000

    - tool_id: "word-crud"
      name: "G√©n√©rateur Word"
      enabled: true
      description: "G√©n√®re les documents d'audit en format Word (plans, rapports, fiches NC, checklists)"
      parameters:
        - name: "title"
          source: "variable"
          value: "document_title"
        - name: "paragraphs"
          source: "variable"
          value: "document_paragraphs"
      output_variable: "word_document"
      on_error: "continue"
      timeout_ms: 30000

    - tool_id: "pdf-crud"
      name: "G√©n√©rateur PDF"
      enabled: true
      description: "G√©n√®re les documents d'audit en format PDF"
      parameters:
        - name: "title"
          source: "variable"
          value: "document_title"
        - name: "content"
          source: "variable"
          value: "document_content"
      output_variable: "pdf_document"
      on_error: "continue"
      timeout_ms: 30000

    - tool_id: "excel-crud"
      name: "G√©n√©rateur Excel"
      enabled: true
      description: "G√©n√®re les checklists et tableaux de suivi en format Excel"
      parameters:
        - name: "title"
          source: "variable"
          value: "checklist_title"
        - name: "data"
          source: "variable"
          value: "checklist_data"
      output_variable: "excel_document"
      on_error: "continue"
      timeout_ms: 30000

    - tool_id: "pptx-crud"
      name: "G√©n√©rateur PowerPoint"
      enabled: true
      description: "G√©n√®re les pr√©sentations d'audit pour r√©unions de cl√¥ture et CODIR"
      parameters:
        - name: "title"
          source: "variable"
          value: "presentation_title"
        - name: "slides"
          source: "variable"
          value: "presentation_slides"
      output_variable: "pptx_document"
      on_error: "continue"
      timeout_ms: 30000

    - tool_id: "file-upload"
      name: "Stockage fichier"
      enabled: true
      description: "Stocke les documents g√©n√©r√©s pour t√©l√©chargement"
      parameters:
        - name: "file"
          source: "previous_output"
      output_variable: "file_id"
      on_error: "continue"

  default_error_handling: "continue"
  parallel_execution: false

ui:
  show_header: true
  header_title: "Audit ISO 9001"
  header_subtitle: "Assistant IA d'Audit de Certification ISO 9001:2015"
  header_icon: "fa fa-clipboard-check"

  sections:
    # Section 1: Onglets principaux (Framework / Chat / G√©n√©rateur)
    - name: "main_tabs"
      title: ""
      layout_type: "column"
      components:
        - type: "tabs"
          name: "main_navigation"
          tabs:
            - id: "framework"
              label: "Framework ISO 9001"
              icon: "fa fa-sitemap"
            - id: "assistant"
              label: "Assistant IA"
              icon: "fa fa-comments"
            - id: "generator"
              label: "G√©n√©rateur de Documents"
              icon: "fa fa-file-alt"

    # Section Framework
    - name: "framework_section"
      title: "Framework d'Audit ISO 9001:2015"
      layout_type: "column"
      gap: "16px"
      visible_when:
        field: "active_tab"
        operator: "equals"
        value: "framework"
      components:
        - type: "select"
          name: "framework_chapter"
          label: "Chapitre ISO"
          placeholder: "S√©lectionnez un chapitre"
          options:
            - value: "4"
              label: "Chapitre 4 - Contexte de l'organisation"
            - value: "5"
              label: "Chapitre 5 - Leadership"
            - value: "6"
              label: "Chapitre 6 - Planification"
            - value: "7"
              label: "Chapitre 7 - Support"
            - value: "8"
              label: "Chapitre 8 - R√©alisation des activit√©s op√©rationnelles"
            - value: "9"
              label: "Chapitre 9 - √âvaluation des performances"
            - value: "10"
              label: "Chapitre 10 - Am√©lioration"

        - type: "select"
          name: "sector_filter"
          label: "Secteur d'activit√©"
          placeholder: "Tous secteurs"
          options:
            - value: ""
              label: "Tous secteurs"
            - value: "industrie"
              label: "Industrie manufacturi√®re"
            - value: "automobile"
              label: "Automobile (IATF 16949)"
            - value: "aeronautique"
              label: "A√©ronautique (EN 9100)"
            - value: "medical"
              label: "Dispositifs m√©dicaux (ISO 13485)"
            - value: "it"
              label: "Services IT / Logiciel"
            - value: "services"
              label: "Services"
            - value: "sante"
              label: "Sant√© (HAS)"
            - value: "agroalimentaire"
              label: "Agroalimentaire"
            - value: "construction"
              label: "Construction / BTP"
            - value: "energie"
              label: "√ânergie"

        - type: "select"
          name: "company_size_filter"
          label: "Taille de l'entreprise"
          placeholder: "Toutes tailles"
          options:
            - value: ""
              label: "Toutes tailles"
            - value: "tpe"
              label: "TPE (< 10 employ√©s)"
            - value: "pme"
              label: "PME (10 - 250 employ√©s)"
            - value: "eti"
              label: "ETI (250 - 5000 employ√©s)"
            - value: "ge"
              label: "Grande Entreprise (> 5000 employ√©s)"

        - type: "markdown_viewer"
          name: "framework_content"
          label: "Contenu du chapitre"
          auto_bind_output: true
          style:
            min_height: "500px"
            border: "1px solid #e5e7eb"
            border_radius: "8px"
            padding: "20px"

    # Section Assistant Conversationnel
    - name: "assistant_section"
      title: "Assistant Conversationnel ISO 9001"
      layout_type: "column"
      gap: "16px"
      visible_when:
        field: "active_tab"
        operator: "equals"
        value: "assistant"
      components:
        - type: "select"
          name: "conversation_mode"
          label: "Mode de conversation"
          default_value: "auditeur"
          options:
            - value: "auditeur"
              label: "Auditeur"
              description: "Vocabulaire technique, focus m√©thodologie et d√©tection NC"
            - value: "audite"
              label: "Audit√© / Responsable Qualit√©"
              description: "Vocabulaire p√©dagogique, focus conformit√© et mise en ≈ìuvre"
            - value: "consultant"
              label: "Consultant / Expert"
              description: "Vocabulaire avanc√©, r√©f√©rences normatives, cas limites"

        - type: "chat_interface"
          name: "iso_chat"
          label: "Chat ISO 9001"
          auto_bind_output: true
          placeholder: "Posez votre question sur la norme ISO 9001:2015..."
          style:
            min_height: "500px"

        - type: "document_upload"
          name: "document_upload"
          label: "Documents qualit√© √† analyser"
          help_text: "Uploadez vos proc√©dures, manuels qualit√©, enregistrements pour une analyse contextuelle"
          accept: ".pdf,.doc,.docx,.xls,.xlsx,.txt"
          multiple: true
          max_size_mb: 25
          required: false

    # Section G√©n√©rateur de Documents
    - name: "generator_section"
      title: "G√©n√©rateur de Documents d'Audit"
      layout_type: "column"
      gap: "16px"
      visible_when:
        field: "active_tab"
        operator: "equals"
        value: "generator"
      components:
        - type: "select"
          name: "document_type"
          label: "Type de document"
          placeholder: "Choisissez le document √† g√©n√©rer"
          required: true
          options:
            - value: "audit_plan"
              label: "Plan d'audit"
              description: "Programme d√©taill√© jour par jour"
            - value: "audit_report"
              label: "Rapport d'audit complet"
              description: "Rapport officiel avec constats, NC, recommandations"
            - value: "nc_sheet"
              label: "Fiche de non-conformit√©"
              description: "Fiche NC professionnelle √† partir de notes brutes"
            - value: "checklist"
              label: "Checklist d'audit personnalis√©e"
              description: "Points de contr√¥le par chapitre"
            - value: "roadmap"
              label: "Feuille de route de mise en conformit√©"
              description: "Plan d'action prioris√© pour l'audit√©"
            - value: "executive_summary"
              label: "Synth√®se ex√©cutive"
              description: "R√©sum√© 2-3 pages pour la direction"

        # Sous-section : Plan d'audit
        - type: "card"
          name: "audit_plan_card"
          title: "Param√®tres du plan d'audit"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "audit_plan"
          components:
            - type: "text_input"
              name: "company_name"
              label: "Nom de l'entreprise"
              placeholder: "Ex: ABC Industries"
              required: true
            - type: "select"
              name: "sector"
              label: "Secteur d'activit√©"
              options:
                - value: "industrie"
                  label: "Industrie manufacturi√®re"
                - value: "automobile"
                  label: "Automobile"
                - value: "aeronautique"
                  label: "A√©ronautique"
                - value: "it"
                  label: "Services IT / Logiciel"
                - value: "services"
                  label: "Services"
                - value: "sante"
                  label: "Sant√©"
                - value: "agroalimentaire"
                  label: "Agroalimentaire"
                - value: "construction"
                  label: "Construction / BTP"
              required: true
            - type: "number_input"
              name: "employee_count"
              label: "Effectif (nombre d'employ√©s)"
              placeholder: "150"
              required: true
            - type: "text_input"
              name: "certification_scope"
              label: "P√©rim√®tre de certification"
              placeholder: "Ex: Conception et fabrication de pi√®ces m√©talliques"
              required: true
            - type: "select"
              name: "audit_type"
              label: "Type d'audit"
              options:
                - value: "certification_initial"
                  label: "Certification initiale"
                - value: "surveillance"
                  label: "Audit de surveillance"
                - value: "renouvellement"
                  label: "Audit de renouvellement"
              required: true
            - type: "number_input"
              name: "audit_duration"
              label: "Dur√©e de l'audit (jours)"
              placeholder: "2"
              required: true
            - type: "textarea"
              name: "excluded_clauses"
              label: "Exclusions de chapitres"
              placeholder: "Ex: 8.3 (pas de conception)"
              required: false
            - type: "textarea"
              name: "specific_focus"
              label: "Focus particuliers"
              placeholder: "Ex: Gestion fournisseurs, processus de conception"
              required: false

        # Sous-section : Fiche NC
        - type: "card"
          name: "nc_sheet_card"
          title: "Saisie du constat"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "nc_sheet"
          components:
            - type: "select"
              name: "iso_chapter"
              label: "Chapitre ISO concern√©"
              options:
                - value: "4.1"
                  label: "4.1 - Contexte de l'organisation"
                - value: "4.2"
                  label: "4.2 - Parties int√©ress√©es"
                - value: "4.3"
                  label: "4.3 - Domaine d'application"
                - value: "4.4"
                  label: "4.4 - SMQ et processus"
                - value: "5.1"
                  label: "5.1 - Leadership et engagement"
                - value: "5.2"
                  label: "5.2 - Politique qualit√©"
                - value: "5.3"
                  label: "5.3 - R√¥les et responsabilit√©s"
                - value: "6.1"
                  label: "6.1 - Risques et opportunit√©s"
                - value: "6.2"
                  label: "6.2 - Objectifs qualit√©"
                - value: "6.3"
                  label: "6.3 - Planification des modifications"
                - value: "7.1"
                  label: "7.1 - Ressources"
                - value: "7.2"
                  label: "7.2 - Comp√©tences"
                - value: "7.3"
                  label: "7.3 - Sensibilisation"
                - value: "7.4"
                  label: "7.4 - Communication"
                - value: "7.5"
                  label: "7.5 - Informations document√©es"
                - value: "8.1"
                  label: "8.1 - Planification op√©rationnelle"
                - value: "8.2"
                  label: "8.2 - Exigences produits/services"
                - value: "8.3"
                  label: "8.3 - Conception et d√©veloppement"
                - value: "8.4"
                  label: "8.4 - Prestataires externes"
                - value: "8.5"
                  label: "8.5 - Production et prestation"
                - value: "8.6"
                  label: "8.6 - Lib√©ration produits"
                - value: "8.7"
                  label: "8.7 - √âl√©ments non conformes"
                - value: "9.1"
                  label: "9.1 - Surveillance et mesure"
                - value: "9.2"
                  label: "9.2 - Audit interne"
                - value: "9.3"
                  label: "9.3 - Revue de direction"
                - value: "10.1"
                  label: "10.1 - Am√©lioration - G√©n√©ralit√©s"
                - value: "10.2"
                  label: "10.2 - Non-conformit√© et actions correctives"
                - value: "10.3"
                  label: "10.3 - Am√©lioration continue"
              required: true
            - type: "textarea"
              name: "raw_notes"
              label: "Notes brutes de l'auditeur"
              placeholder: "Saisissez vos notes telles quelles. L'IA les reformulera en constat professionnel."
              help_text: "Ex: Manque attestations formation pour 3 gars en soudage. Vus Martin, Durand, Petit - pas de certifs dans dossiers. RH dit en cours."
              required: true
              style:
                min_height: "150px"

        # Sous-section : Checklist
        - type: "card"
          name: "checklist_card"
          title: "Param√®tres de la checklist"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "checklist"
          components:
            - type: "multi_select"
              name: "selected_chapters"
              label: "Chapitres √† inclure"
              options:
                - value: "4"
                  label: "Chapitre 4 - Contexte"
                - value: "5"
                  label: "Chapitre 5 - Leadership"
                - value: "6"
                  label: "Chapitre 6 - Planification"
                - value: "7"
                  label: "Chapitre 7 - Support"
                - value: "8"
                  label: "Chapitre 8 - R√©alisation"
                - value: "9"
                  label: "Chapitre 9 - √âvaluation"
                - value: "10"
                  label: "Chapitre 10 - Am√©lioration"
              required: true
            - type: "select"
              name: "checklist_sector"
              label: "Secteur d'activit√©"
              options:
                - value: ""
                  label: "G√©n√©rique"
                - value: "industrie"
                  label: "Industrie"
                - value: "automobile"
                  label: "Automobile"
                - value: "it"
                  label: "IT / Logiciel"
                - value: "services"
                  label: "Services"
                - value: "sante"
                  label: "Sant√©"
            - type: "select"
              name: "checklist_company_size"
              label: "Taille de l'entreprise"
              options:
                - value: "tpe"
                  label: "TPE (< 10 employ√©s)"
                - value: "pme"
                  label: "PME (10-250)"
                - value: "eti"
                  label: "ETI (250-5000)"
                - value: "ge"
                  label: "GE (> 5000)"

        # Sous-section : Rapport d'audit
        - type: "card"
          name: "audit_report_card"
          title: "Donn√©es du rapport d'audit"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "audit_report"
          components:
            - type: "text_input"
              name: "report_company_name"
              label: "Entreprise audit√©e"
              required: true
            - type: "text_input"
              name: "audit_id"
              label: "Identifiant de l'audit"
              placeholder: "AUD-2026-001"
              required: true
            - type: "text_input"
              name: "audit_dates"
              label: "Dates de l'audit"
              placeholder: "20-21 f√©vrier 2026"
              required: true
            - type: "select"
              name: "report_audit_type"
              label: "Type d'audit"
              options:
                - value: "certification_initial"
                  label: "Certification initiale"
                - value: "surveillance"
                  label: "Surveillance"
                - value: "renouvellement"
                  label: "Renouvellement"
              required: true
            - type: "textarea"
              name: "findings_json"
              label: "Constats (un par ligne)"
              placeholder: "NC mineure ¬ß7.2 : Preuves de comp√©tence manquantes pour 3 op√©rateurs soudage\nObservation ¬ß6.2 : Objectifs qualit√© pas tous SMART\nPoint fort : Culture qualit√© bien ancr√©e"
              help_text: "Saisissez vos constats, l'IA les structurera automatiquement"
              required: true
              style:
                min_height: "200px"
            - type: "textarea"
              name: "positive_points"
              label: "Points forts"
              placeholder: "Culture qualit√©, digitalisation, implication direction..."
              required: false
            - type: "select"
              name: "recommendation"
              label: "Recommandation"
              options:
                - value: "certification"
                  label: "Certification / Maintien"
                - value: "certification_conditional"
                  label: "Certification sous r√©serve (NC majeures √† traiter)"
                - value: "refusal"
                  label: "Refus / Non-maintien"
              required: true

        # Sous-section : Feuille de route
        - type: "card"
          name: "roadmap_card"
          title: "Donn√©es pour la feuille de route"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "roadmap"
          components:
            - type: "textarea"
              name: "roadmap_findings"
              label: "Non-conformit√©s et observations"
              placeholder: "Listez les NC et observations issues de l'audit"
              required: true
              style:
                min_height: "200px"

        # Sous-section : Synth√®se ex√©cutive
        - type: "card"
          name: "executive_summary_card"
          title: "Donn√©es pour la synth√®se ex√©cutive"
          visible_when:
            field: "document_type"
            operator: "equals"
            value: "executive_summary"
          components:
            - type: "text_input"
              name: "summary_company"
              label: "Entreprise"
              required: true
            - type: "textarea"
              name: "summary_findings"
              label: "R√©sum√© des constats"
              placeholder: "R√©sum√© des r√©sultats de l'audit"
              required: true
              style:
                min_height: "150px"

        # Zone de r√©sultat
        - type: "select"
          name: "export_format"
          label: "Format d'export"
          default_value: "word"
          options:
            - value: "word"
              label: "Word (.docx)"
            - value: "pdf"
              label: "PDF"
            - value: "excel"
              label: "Excel (.xlsx)"
            - value: "markdown"
              label: "Markdown"
          visible_when:
            field: "document_type"
            operator: "is_not_empty"

        - type: "progress_bar"
          name: "generation_progress"
          label: "Progression"
          data_source: "generation_progress_value"

        - type: "markdown_viewer"
          name: "generated_document_preview"
          label: "Aper√ßu du document"
          auto_bind_output: true
          style:
            min_height: "400px"
            border: "1px solid #e5e7eb"
            border_radius: "8px"
            padding: "20px"

  show_sidebar: true
  sidebar_sections:
    - name: "quick_links"
      title: "Acc√®s rapide"
      components:
        - type: "button"
          name: "btn_chapter4"
          label: "Ch.4 - Contexte"
          button_action: "custom"
          custom_action: "navigateChapter4"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter5"
          label: "Ch.5 - Leadership"
          button_action: "custom"
          custom_action: "navigateChapter5"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter6"
          label: "Ch.6 - Planification"
          button_action: "custom"
          custom_action: "navigateChapter6"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter7"
          label: "Ch.7 - Support"
          button_action: "custom"
          custom_action: "navigateChapter7"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter8"
          label: "Ch.8 - R√©alisation"
          button_action: "custom"
          custom_action: "navigateChapter8"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter9"
          label: "Ch.9 - √âvaluation"
          button_action: "custom"
          custom_action: "navigateChapter9"
          button_variant: "text"
        - type: "button"
          name: "btn_chapter10"
          label: "Ch.10 - Am√©lioration"
          button_action: "custom"
          custom_action: "navigateChapter10"
          button_variant: "text"

    - name: "audit_stats"
      title: "Statistiques"
      components:
        - type: "text_display"
          name: "messages_count"
          label: "Messages √©chang√©s"
          data_source: "total_messages"
        - type: "text_display"
          name: "documents_generated"
          label: "Documents g√©n√©r√©s"
          data_source: "total_documents"

  show_footer: true
  footer_content: "‚ö†Ô∏è Les r√©ponses sont fournies √† titre informatif. L'interpr√©tation finale rel√®ve de l'auditeur certifi√©."

  show_actions: true
  actions:
    - type: "button"
      name: "reset_button"
      label: "R√©initialiser"
      button_action: "reset_form"
      button_variant: "secondary"

    - type: "button"
      name: "generate_button"
      label: "G√©n√©rer le document"
      button_action: "trigger_agent"
      button_variant: "primary"
      is_trigger_button: true
      visible_when:
        field: "active_tab"
        operator: "equals"
        value: "generator"

  actions_position: "right"
  theme: "auto"
  primary_color: "#1E40AF"

connectors:
  default_connector: "anthropic-iso"
  connectors:
    - id: "anthropic-iso"
      provider: "anthropic"
      name: "Claude Sonnet"
      description: "Optimis√© pour l'analyse normative et la r√©daction de documents longs"
      model: "claude-sonnet-4-20250514"
      default_temperature: 0.4
      default_max_tokens: 8192
      retry_on_error: true
      max_retries: 3
      timeout_ms: 120000
      priority: 0

    - id: "mistral-iso"
      provider: "mistral"
      name: "Mistral Large"
      description: "Alternative Mistral pour documents en fran√ßais"
      model: "mistral-large-latest"
      default_temperature: 0.4
      default_max_tokens: 8192
      retry_on_error: true
      max_retries: 2
      timeout_ms: 120000
      priority: 1

    - id: "openai-iso"
      provider: "openai"
      name: "GPT-4"
      description: "Alternative OpenAI"
      model: "gpt-4"
      default_temperature: 0.4
      default_max_tokens: 8192
      retry_on_error: true
      max_retries: 2
      timeout_ms: 120000
      priority: 2

  enable_fallback: true
  fallback_order:
    - "anthropic-iso"
    - "mistral-iso"
    - "openai-iso"

workflows:
  workflows:
    # Workflow 1: Chat conversationnel
    - name: "ISO Chat Workflow"
      description: "Conversation avec l'assistant ISO 9001"
      trigger: "user_message"
      enabled: true
      steps:
        - id: "check_documents"
          name: "V√©rifier documents upload√©s"
          type: "condition"
          condition:
            variable: "uploaded_documents"
            operator: "is_not_empty"
          on_true: "extract_docs"
          on_false: "chat_response"

        - id: "extract_docs"
          name: "Extraire contenu documents"
          type: "tool_call"
          tool_config_id: "document-extractor"
          output_variable: "extracted_content"
          on_error: "continue"
          next_step: "chat_response"

        - id: "chat_response"
          name: "G√©n√©rer r√©ponse ISO"
          type: "llm_call"
          prompt_template: |
            {{system_prompt}}

            Mode: {{conversation_mode}}
            {{#if extracted_content}}
            Documents analys√©s:
            {{extracted_content}}
            {{/if}}

            Question: {{message}}
          system_prompt: "{{system_prompt}}"
          temperature: 0.4
          max_tokens: 4096
          output_variable: "response"

      entry_step: "check_documents"
      initial_variables:
        conversation_mode: "auditeur"
        extracted_content: null

    # Workflow 2: G√©n√©ration de documents
    - name: "Document Generation Workflow"
      description: "G√©n√©ration de documents d'audit"
      trigger: "button_click"
      trigger_config:
        button: "generate_button"
      enabled: true
      steps:
        - id: "identify_doc_type"
          name: "Identifier le type de document"
          type: "condition"
          condition:
            variable: "document_type"
            operator: "is_not_empty"
          on_true: "generate_content"
          on_false: "error_no_type"

        - id: "generate_content"
          name: "G√©n√©rer le contenu avec IA"
          type: "llm_call"
          prompt_template: |
            {{system_prompt}}

            {{#if document_type == 'audit_plan'}}
            {{task_prompts.audit_plan_generation}}
            {{/if}}
            {{#if document_type == 'audit_report'}}
            {{task_prompts.audit_report_generation}}
            {{/if}}
            {{#if document_type == 'nc_sheet'}}
            {{task_prompts.nc_sheet_generation}}
            {{/if}}
            {{#if document_type == 'checklist'}}
            {{task_prompts.checklist_generation}}
            {{/if}}
            {{#if document_type == 'roadmap'}}
            {{task_prompts.roadmap_generation}}
            {{/if}}
            {{#if document_type == 'executive_summary'}}
            G√©n√®re une synth√®se ex√©cutive de 2-3 pages.
            Entreprise: {{summary_company}}
            Constats: {{summary_findings}}
            {{/if}}
          temperature: 0.3
          max_tokens: 8192
          output_variable: "generated_content"
          next_step: "select_export"

        - id: "select_export"
          name: "S√©lectionner format d'export"
          type: "condition"
          condition:
            variable: "export_format"
            operator: "equals"
            value: "word"
          on_true: "generate_word"
          on_false: "check_excel"

        - id: "check_excel"
          name: "V√©rifier si export Excel"
          type: "condition"
          condition:
            variable: "export_format"
            operator: "equals"
            value: "excel"
          on_true: "generate_excel"
          on_false: "complete"

        - id: "generate_word"
          name: "G√©n√©rer le document Word"
          type: "tool_call"
          tool_config_id: "word-crud"
          output_variable: "word_bytes"
          on_error: "continue"
          next_step: "upload_file"

        - id: "generate_excel"
          name: "G√©n√©rer le fichier Excel"
          type: "tool_call"
          tool_config_id: "excel-crud"
          output_variable: "excel_bytes"
          on_error: "continue"
          next_step: "upload_file"

        - id: "upload_file"
          name: "Sauvegarder le fichier"
          type: "tool_call"
          tool_config_id: "file-upload"
          output_variable: "generated_file_id"
          on_error: "continue"
          next_step: "complete"

        - id: "complete"
          name: "Terminer la g√©n√©ration"
          type: "set_variable"
          variable_name: "generation_complete"
          variable_value: true

        - id: "error_no_type"
          name: "Erreur: pas de type s√©lectionn√©"
          type: "set_variable"
          variable_name: "error_message"
          variable_value: "Veuillez s√©lectionner un type de document √† g√©n√©rer."

      entry_step: "identify_doc_type"
      initial_variables:
        generated_content: null
        generated_file_id: null
        generation_complete: false
        generation_progress_value: 0
      timeout_ms: 300000

    # Workflow 3: Framework navigation
    - name: "Framework Navigation Workflow"
      description: "Navigation dans le framework ISO 9001"
      trigger: "form_submit"
      enabled: true
      steps:
        - id: "load_chapter"
          name: "Charger le chapitre"
          type: "llm_call"
          prompt_template: |
            {{system_prompt}}

            Pr√©sente de mani√®re exhaustive et structur√©e le chapitre {{framework_chapter}} de la norme ISO 9001:2015.

            {{#if sector_filter}}
            Adapte les particularit√©s sectorielles au secteur : {{sector_filter}}
            {{/if}}
            {{#if company_size_filter}}
            Adapte les exemples √† une entreprise de taille : {{company_size_filter}}
            {{/if}}

            Structure ta r√©ponse avec :
            ## Sous-chapitres et exigences
            Pour chaque sous-chapitre :
            ### X.X - Titre
            **Exigences normatives** : texte et interpr√©tation
            **Points de contr√¥le** : ‚úÖ liste
            **Preuves attendues** : üìÑ liste
            **Documents associ√©s** : liste
            **NC fr√©quentes** : tableau (Type | Description | Fr√©quence | Gravit√©)
            **Questions d'audit sugg√©r√©es** : liste par r√¥le
            {{#if sector_filter}}
            **Particularit√©s sectorielles ({{sector_filter}})** : sp√©cificit√©s
            {{/if}}
          temperature: 0.3
          max_tokens: 8192
          output_variable: "framework_content"

      entry_step: "load_chapter"
      initial_variables:
        framework_content: null

  default_workflow: "iso-chat"

security:
  requires_auth: false
  rate_limit_enabled: true
  requests_per_minute: 20
  requests_per_hour: 300
  sanitize_inputs: true
  max_input_length: 100000
  audit_logging: true

deployment:
  auto_route: true
  environment: "production"
  min_instances: 1
  max_instances: 5
  health_check_enabled: true
