# Agent Descriptor Language (ADL) v1.0.0
# Email POD Attachment Analyzer - Email and attachment processing

metadata:
  adl_version: "1.0.0"
  schema_url: "https://agent-pf.io/schemas/adl/v1"
  version: "1.0.0"
  tags:
    - email
    - attachment
    - eml
    - analysis
    - extraction
  changelog:
    - "1.0.0: Initial ADL conversion"

identity:
  id: "email-pod-analyzer"
  name: "Email POD Analyzer"
  slug: "email-pod-analyzer"
  description: "Analyse d'emails et de leurs pièces jointes"
  long_description: |
    Agent spécialisé dans l'analyse d'emails (fichiers .eml) et leurs pièces jointes.

    ## Fonctionnalités
    - Parsing de fichiers EML
    - Extraction des métadonnées
    - Analyse des pièces jointes
    - Synthèse du contenu

    ## Cas d'usage
    - Traitement de demandes par email
    - Analyse de communications
    - Extraction d'informations de correspondance
  icon: "fa fa-envelope-open-text"
  category: "data_processing"
  status: "active"

business_logic:
  system_prompt: |
    Tu es un assistant spécialisé dans l'analyse d'emails professionnels.

    Analyse l'email fourni et ses pièces jointes pour extraire:
    1. Les informations de l'expéditeur et destinataires
    2. Le sujet et la date
    3. Le contenu principal du message
    4. Les pièces jointes et leur nature
    5. Les actions ou demandes identifiées
    6. L'urgence et la priorité

    Format de réponse:

    ## Informations Email
    - **De:** [expéditeur]
    - **À:** [destinataires]
    - **Date:** [date]
    - **Objet:** [sujet]

    ## Résumé
    [Synthèse en 2-3 phrases]

    ## Contenu Analysé
    [Points clés du message]

    ## Pièces Jointes
    - [Liste des pièces jointes avec description]

    ## Actions Identifiées
    - [ ] [Action 1]
    - [ ] [Action 2]

    ## Priorité
    [Évaluation de l'urgence: Haute/Moyenne/Basse]

  user_prompt_template: |
    Analyse l'email suivant:

    {{email_content}}

    {{#if attachments_content}}
    Contenu des pièces jointes:
    {{attachments_content}}
    {{/if}}

  personality_traits:
    - name: "organized"
      intensity: 1.6
    - name: "efficient"
      intensity: 1.4
    - name: "thorough"
      intensity: 1.3

  tone: "professional"
  language: "auto"

  llm_provider: "mistral"
  llm_model: "mistral-small-latest"
  temperature: 0.3
  max_tokens: 4000

  context_window_messages: 3
  include_system_context: true
  streaming_enabled: false

  moderation:
    enabled: false

  classification:
    enabled: true
    provider: "content-classification"

  instructions:
    - "Identifier clairement les actions requises"
    - "Évaluer l'urgence objectivement"
    - "Résumer le contenu de manière concise"

  constraints:
    - "Ne pas divulguer d'informations confidentielles"
    - "Respecter la vie privée des correspondants"

tools:
  tools:
    - tool_id: "eml-parser"
      name: "Parser EML"
      enabled: true
      description: "Parse les fichiers email .eml"
      parameters:
        - name: "file"
          source: "input"
          input_component: "email_upload"
          required: true
      output_variable: "parsed_email"
      on_error: "stop"
      timeout_ms: 30000

    - tool_id: "document-extractor"
      name: "Extracteur de pièces jointes"
      enabled: true
      description: "Extrait le contenu des pièces jointes"
      parameters:
        - name: "file"
          source: "variable"
          value: "attachment_file"
      output_variable: "attachment_content"
      on_error: "continue"
      timeout_ms: 60000

  default_error_handling: "continue"
  parallel_execution: false

ui:
  show_header: true
  header_title: "Analyseur d'Emails"
  header_subtitle: "Traitement intelligent des emails et pièces jointes"
  header_icon: "fa fa-envelope-open-text"

  sections:
    - name: "upload_section"
      title: "Email à analyser"
      layout_type: "column"
      gap: "16px"
      components:
        - type: "file_upload"
          name: "email_upload"
          label: "Fichier Email (.eml)"
          help_text: "Déposez un fichier email au format .eml"
          accept: ".eml"
          multiple: false
          max_size_mb: 50
          required: true

        - type: "checkbox"
          name: "analyze_attachments"
          label: "Analyser les pièces jointes"
          default_value: true

        - type: "checkbox"
          name: "extract_actions"
          label: "Extraire les actions à faire"
          default_value: true

    - name: "results_section"
      title: "Analyse de l'email"
      layout_type: "column"
      gap: "16px"
      components:
        - type: "markdown_viewer"
          name: "email_analysis"
          label: "Résultat"
          auto_bind_output: true
          style:
            min_height: "400px"
            border: "1px solid #e5e7eb"
            border_radius: "8px"
            padding: "16px"

  show_sidebar: false
  show_footer: false

  show_actions: true
  actions:
    - type: "button"
      name: "reset_button"
      label: "Nouvel email"
      button_action: "reset_form"
      button_variant: "secondary"

    - type: "button"
      name: "analyze_button"
      label: "Analyser l'email"
      button_action: "trigger_agent"
      button_variant: "primary"
      is_trigger_button: true

  actions_position: "right"
  theme: "auto"
  primary_color: "#8B5CF6"

connectors:
  default_connector: "mistral-email"
  connectors:
    - id: "mistral-email"
      provider: "mistral"
      name: "Mistral Small"
      description: "Analyse d'emails"
      model: "mistral-small-latest"
      default_temperature: 0.3
      default_max_tokens: 4000
      retry_on_error: true
      max_retries: 2
      timeout_ms: 60000
      priority: 0

  enable_fallback: false

workflows:
  workflows:
    - name: "Email Analysis Flow"
      description: "Analyse d'email avec pièces jointes"
      trigger: "button_click"
      trigger_config:
        button: "analyze_button"
      enabled: true
      steps:
        - id: "parse"
          name: "Parser l'email"
          type: "tool_call"
          tool_config_id: "eml-parser"
          output_variable: "parsed_email"
          on_error: "stop"
          next_step: "check_attachments"

        - id: "check_attachments"
          name: "Vérifier les pièces jointes"
          type: "condition"
          condition:
            variable: "analyze_attachments"
            operator: "eq"
            value: true
            and_conditions:
              - variable: "parsed_email.attachments"
                operator: "is_not_empty"
          on_true: "extract_attachments"
          on_false: "analyze"

        - id: "extract_attachments"
          name: "Extraire les pièces jointes"
          type: "loop"
          loop_variable: "parsed_email.attachments"
          loop_item_name: "attachment"
          loop_body:
            - id: "extract_one"
              name: "Extraire une pièce jointe"
              type: "tool_call"
              tool_config_id: "document-extractor"
          output_variable: "attachments_content"
          next_step: "analyze"

        - id: "analyze"
          name: "Analyser avec l'IA"
          type: "llm_call"
          prompt_template: |
            {{system_prompt}}

            Email parsé:
            {{parsed_email}}

            {{#if attachments_content}}
            Pièces jointes:
            {{attachments_content}}
            {{/if}}
          output_variable: "analysis"

      entry_step: "parse"
      initial_variables:
        parsed_email: null
        attachments_content: []
        analysis: null

      timeout_ms: 180000

  default_workflow: "email-analysis"

security:
  requires_auth: false
  rate_limit_enabled: true
  requests_per_minute: 10
  requests_per_hour: 100
  sanitize_inputs: true
  max_input_length: 500000
  audit_logging: true

deployment:
  auto_route: true
  environment: "production"
  min_instances: 1
  max_instances: 2
  health_check_enabled: true
